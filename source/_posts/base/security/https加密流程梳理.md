---
title: https加密流程梳理
categories:
  - 猿基础
tags:
  - 网络
  - https
date: 2018-08-31 23:50:07
---

密码学是一个很大的学科，要想了解https加密流程得先理解对称加密和非对称加密)是什么。可以直接在本站搜索。接下来带着问题，我们来逐步完善https的加密流程

# 能否用对称加密？

使用对称加密，有一个前置要求：密钥双方都要知道，也就是要协商好。在互联网场景下，用户的客户端和服务器无法一对一协商，只能在用户需要访问的时候，由服务器传给客户端（或者客户端传给服务器）。密钥在互联网的传输过程中，如果被人拦截，那么密钥泄漏，也就失去了加密的意义，这就是叫**中间人攻击**。这个问题答案是不能。

既然中间人攻击的原因就是密钥直接在网络中传输导致的泄漏，有没有可能不传输密钥？有一个办法，就是所有客户端/浏览器都记下所有网站的密钥，这显然是不现实的。

基于上面说的原因，在互联网上只对称加密是有安全风险的。

```mermaid
sequenceDiagram
    client->>server: 发起请求
    server->>client: 发送密钥waw
    note right of client: 如果此时有人拦截得到密钥waw，那么本次同学加密就失效
    client->>client: 用服务端密钥加密信如"你好"变成"123"
    client->>server: 123
    server->>server: 用密钥解密"123"得到"你好"
    server->>server: 用密钥加密信息，如"我很好"变成"ABCD"
    server->>client: ABCD
    client ->> server: 用密钥解密"ABCD"得到"我很好"
```

# 能否用一对非对称加密？

不能，因为双工通信，双方都需要加密，同理双方都需要解密。所以需要两对非对称加密密钥。

# 能否对所有客户端使用一对密钥？

不能，如果所有客户端用一个公钥加密，那么所有用户用相同私钥就能解密。也就是不同客户端可以看到彼此服务端发送的消息。客户端对所有服务端能否使用一对密钥？回答同样如此。

# 现在画一个简版非对称加密流程

``` mermaid
sequenceDiagram
    client->>server: 客户端公钥
    server->>server: 保存客户端公钥
    server->>client: 服务端公钥
    client->>client: 保存服务端公钥
    client->>client: 用服务端公钥加密信息，如"你好"变成"123"
    client->>server: 123
    server->>server: 用服务端私钥解密"123"得到"你好"
    server->>server: 用客户端公钥加密信息，如"我很好"变成"ABCD"
    server->>client: ABCD
    client ->> server: 用客户端秘钥解密"ABCD"得到"我很好"
```

